<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" href="/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vite App</title>
        <!-- <style>
            .text {
                color: greenyellow;
            }
        </style> -->
    </head>

    <body>
        <!-- <div class="text" style="color: black">···</div> -->
        <div style="color: red">···</div>
        <!-- <div class="text">···</div> -->
        <div id="app"></div>

        <script type="module" src="/src/main.ts"></script>
        <script type="module" src="./src/_test.js"></script>
    </body>
    <script>
        const addRemote = async (a, b) =>
            new Promise(resolve => {
                const result = a + b;
                setTimeout(() => resolve(result), result * 10);
            });
        // 请实现本地的 add 方法，所有的加法都需要调用 addRemote
        // 以最快的实现输入数字的加法
        async function add(...inputs) {
            return new Promise((resolve, reject) => {
                let count = 0; // 用于累计当前正在计算中的数量，目的是为了全部计算完成时返回结果
                const rec = () => {
                    while (inputs.length > 1) {
                        count++; // 每计算一次，累计次数加 1
                        addRemote(inputs.shift(), inputs.shift())
                            .then(res => {
                                inputs.push(res); // 把计算结果添加到待计算列表中
                                count--; // 计算完，累计次数减 1
                                rec(); // 只要有结果
                            })
                            .catch(reject)
                            .finally(() => {
                                if (count === 0) resolve(inputs[0]); // 为 0 说明全部计算完毕，返会计算结果
                            });
                    }
                };
                rec();
            });
        }
        // 请用示例验证运行结果：
        const logWithTime = promise => {
            const start = Date.now();
            promise.then(result => {
                console.log(`result is: ${result}, cost: ${Date.now() - start}ms`);
            });
        };
        logWithTime(add(1, 2, 3)); // 6
        logWithTime(add(1, 2, 3, 200, 6, 7, 3, 2, 7, 8, 9, 100)); // 348
        logWithTime(add(1, 2, 3, 20, 6, 7, 3, 2, 7, 8, 9, 10, 3, 20, 6, 7, 3, 2, 7, 8, 9, 10)); // 153
    </script>
</html>

